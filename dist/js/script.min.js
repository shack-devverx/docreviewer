alert("ATTN USER: select the folder button on the toolbar to choose a local folder of documents and images for review. This is a CONFIDENTIAL PROTOTYPE for demonstration purposes only. No other use is permitted. © 2024 Adam J Schwartz, All Rights Reserved"),document.getElementById("help-button").addEventListener("click",function(){document.getElementById("help-window").style.display="block"}),document.getElementById("close-help").addEventListener("click",function(){document.getElementById("help-window").style.display="none"});let pdfDoc=null,pageNum=1,pageCount=0,zoomLevel=1.25,rotationAngle=0,currentDocIndex=0,canvas=document.getElementById("pdf-canvas"),ctx=canvas.getContext("2d"),fileArray=[],pinnedDocs=JSON.parse(localStorage.getItem("pinnedDocs"))||[],tags=JSON.parse(localStorage.getItem("tags"))||[],selectedTagIndex=null;function updateTagList(){let e=document.getElementById("tag-list");e.innerHTML="",tags.forEach((t,n)=>{let a=document.createElement("li");a.textContent=t.name,a.style.backgroundColor=t.color,a.style.color=getContrastColor(t.color),a.addEventListener("click",e=>{e.stopPropagation(),document.querySelectorAll("#tag-list li").forEach(e=>e.classList.remove("selected")),a.classList.add("selected"),selectedTagIndex=n,document.getElementById("tag-input").value=t.name,document.getElementById("tag-color").value=t.color}),e.appendChild(a)})}function getContrastColor(e){return e=e.replace("#",""),128<=(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3?"black":"white"}function saveTagsToLocalStorage(){localStorage.setItem("tags",JSON.stringify(tags))}function updateTagDropdown(){document.querySelectorAll(".tag-dropdown").forEach(n=>{n.innerHTML='<option value="">Select Tag</option>',tags.forEach(e=>{var t=document.createElement("option");t.value=e.name,t.textContent=e.name,n.appendChild(t)})})}function updatePinnedDocsList(){let d=document.getElementById("pinned-list");d.innerHTML="",pinnedDocs.forEach((a,e)=>{var t=document.createElement("li"),n=(t.textContent=a.name,document.createElement("span"));n.innerHTML=`
                   <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#a)" stroke="#FF000D" stroke-miterlimit="10"><path d="M10.431 11.319a1.84 1.84 0 0 1-.56 1.468c-.176.177-.416.162-.61-.032q-1.131-1.13-2.26-2.262c-.04-.037-.068-.087-.108-.14-.067.062-.11.101-.151.141-1.257 1.242-2.468 2.531-3.803 3.691-.615.536-1.253 1.044-1.883 1.563-.065.052-.147.084-.22.126h-.15c-.353-.151-.415-.415-.17-.723a42 42 0 0 1 3.548-3.976c.604-.59 1.198-1.193 1.809-1.802l-.116-.122-2.38-2.38c-.253-.253-.25-.474.013-.714a1.865 1.865 0 0 1 2.412-.102q.044.036.102.08l1.118-.96 3.904 3.903-.919 1.07q-.016.02-.038.055c.273.322.437.692.462 1.114zm6.05-6.544a.5.5 0 0 1-.104.192 1.39 1.39 0 0 1-1.55.303c-.075-.033-.122-.051-.19.027Q13.232 6.94 11.823 8.58L7.919 4.678l3.365-2.89c-.14-.278-.2-.565-.153-.873q.075-.487.431-.82a.39.39 0 0 1 .486-.023 1 1 0 0 1 .102.09l4.186 4.183c.12.12.197.254.146.427z" fill="#FF000D" stroke-width=".249"/><path d="M14.538 11.498 4.237 1.447" stroke-width=".746" stroke-linecap="round"/></g><defs><clipPath id="a"><path fill="#fff" d="M.244 0h16.252v16H.244z"/></clipPath></defs></svg>
                `,n.style.cursor="pointer",n.style.marginLeft="10px",n.addEventListener("click",()=>{unpinDocument(e)});let o=document.createElement("select"),l=(o.classList.add("tag-dropdown"),o.innerHTML='<option value="">Select Tag</option>',tags.forEach(e=>{var t=document.createElement("option");t.value=e.name,t.textContent=e.name,o.appendChild(t)}),o.addEventListener("change",()=>{var e=tags.find(e=>e.name===o.value);e&&addTagToDocument(a,e),o.value=""}),document.createElement("div"));l.style.marginTop="5px",a.tags&&a.tags.forEach(e=>{var t=document.createElement("span"),n=(t.textContent=e.name,t.className="assigned-tag",t.style.backgroundColor=e.color,t.style.color=getContrastColor(e.color),document.createElement("span"));n.textContent="✖",n.style.marginLeft="5px",n.style.cursor="pointer",n.addEventListener("click",()=>removeTagFromDocument(a,e)),t.appendChild(n),l.appendChild(t)}),t.appendChild(n),t.appendChild(o),t.appendChild(l),d.appendChild(t)}),savePinnedDocsToLocalStorage()}function unpinDocument(e){pinnedDocs.splice(e,1),updatePinnedDocsList()}function addTagToDocument(e,t){e.tags||(e.tags=[]),e.tags.some(e=>e.name===t.name)||(e.tags.push(t),updatePinnedDocsList())}function removeTagFromDocument(e,t){e.tags=e.tags.filter(e=>e.name!==t.name),updatePinnedDocsList()}function savePinnedDocsToLocalStorage(){localStorage.setItem("pinnedDocs",JSON.stringify(pinnedDocs))}function loadDocument(e){var t,n,a;e<0||e>=fileArray.length||(currentDocIndex=e,t=fileArray[e],hideAllViewers(),n="pdf"===t.type,a="image"===t.type,document.getElementById("prev-page").disabled=!n,document.getElementById("next-page").disabled=!n,document.getElementById("zoom-in").disabled=!(n||a),document.getElementById("zoom-out").disabled=!(n||a),document.getElementById("rotate").disabled=!(n||a),n?displayPDF(t.content):"docx"===t.type?displayDocx(t.content):"xlsx"===t.type?displayXlsx(t.content):"txt"===t.type?displayTxtFile(t.content):a&&displayImage(t.content),document.getElementById("document-select").value=e)}function hideAllViewers(){document.getElementById("pdf-viewer").style.display="none",document.getElementById("docx-viewer").style.display="none",document.getElementById("xlsx-viewer").style.display="none",document.getElementById("txt-viewer").style.display="none",document.getElementById("image-viewer").style.display="none"}function displayPDF(e){document.getElementById("pdf-viewer").style.display="block",pdfjsLib.getDocument({data:atob(e.split(",")[1])}).promise.then(e=>{pdfDoc=e,pageCount=pdfDoc.numPages,document.getElementById("page-count").textContent=pageCount,pageNum=1,rotationAngle=0,renderPage(pageNum)})}function displayDocx(e){document.getElementById("docx-viewer").style.display="block",fetch(e).then(e=>e.arrayBuffer()).then(e=>mammoth.convertToHtml({arrayBuffer:e})).then(e=>{document.getElementById("docx-viewer").innerHTML=e.value}).catch(console.error)}function displayXlsx(e){document.getElementById("xlsx-viewer").style.display="block",fetch(e).then(e=>e.arrayBuffer()).then(e=>{e=XLSX.read(e,{type:"array"}),e=XLSX.utils.sheet_to_html(e.Sheets[e.SheetNames[0]]);document.getElementById("xlsx-viewer").innerHTML=e}).catch(console.error)}function displayTxtFile(e){document.getElementById("txt-viewer").style.display="block",fetch(e).then(e=>e.text()).then(e=>{document.getElementById("txt-viewer").innerText=e}).catch(console.error)}function displayImage(e){document.getElementById("image-viewer").style.display="block",document.getElementById("image-viewer").src=e}function renderPage(n){pdfDoc.getPage(n).then(e=>{var t=e.getViewport({scale:zoomLevel,rotation:rotationAngle}),t=(canvas.width=t.width,canvas.height=t.height,canvas.style.width=t.width+"px",canvas.style.height=t.height+"px",{canvasContext:ctx,viewport:t});e.render(t).promise.then(()=>{document.getElementById("page-num").textContent=n})})}function adjustImageViewer(){var e=document.getElementById("image-viewer");e.style.transform=`scale(${zoomLevel}) rotate(${rotationAngle}deg)`,e.style.maxWidth=100*zoomLevel+"%",e.style.maxHeight=100*zoomLevel+"%"}function saveFilesToLocalStorage(){localStorage.setItem("savedFiles",JSON.stringify(fileArray))}function loadFilesFromLocalStorage(){var e=JSON.parse(localStorage.getItem("savedFiles"))||[];fileArray=e}function getFileType(e){return e.endsWith(".pdf")?"pdf":/\.(docx)$/i.test(e)?"docx":/\.(xlsx)$/i.test(e)?"xlsx":e.endsWith(".txt")?"txt":/\.(jpeg|jpg|png|gif|tiff)$/i.test(e)?"image":"unknown"}function populateDocumentSelect(){let a=document.getElementById("document-select");a.innerHTML="",fileArray.sort((e,t)=>e.name.localeCompare(t.name)),fileArray.forEach((e,t)=>{var n=document.createElement("option");n.value=t,n.textContent=e.name,a.appendChild(n)}),0<fileArray.length&&(a.value=currentDocIndex),a.addEventListener("change",e=>{loadDocument(parseInt(e.target.value))}),updateRemoveButtonVisibility()}function updateRemoveButtonVisibility(){document.getElementById("remove-file").style.display=0<fileArray.length?"inline-block":"none"}function getContrastColor(e){return"#"===e.slice(0,1)&&(e=e.slice(1)),128<=(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3?"black":"white"}document.getElementById("add-tag").addEventListener("click",()=>{document.getElementById("tag-popup").style.display="block",document.getElementById("tag-input").value="",document.getElementById("tag-color").value="#007BFF",document.getElementById("error-message").style.display="none",selectedTagIndex=null,updateTagList()}),document.getElementById("close-tag-popup").addEventListener("click",()=>{document.getElementById("tag-popup").style.display="none"}),document.getElementById("save-tag").addEventListener("click",e=>{e.stopPropagation();let t=document.getElementById("tag-input").value.trim();var e=document.getElementById("tag-color").value,n=document.getElementById("error-message");t?9<=tags.length&&null===selectedTagIndex?(n.textContent="You can only create a maximum of 9 tags.",n.style.display="block"):tags.some(e=>e.name.toLowerCase()===t.toLowerCase())&&null===selectedTagIndex?(n.textContent="A tag with this name already exists.",n.style.display="block"):(n.style.display="none",null!==selectedTagIndex?tags[selectedTagIndex]={name:t,color:e}:tags.push({name:t,color:e}),saveTagsToLocalStorage(),document.getElementById("tag-input").value="",document.getElementById("tag-color").value="#007BFF",selectedTagIndex=null,updateTagList(),updateTagDropdown()):(n.textContent="Tag name can't be empty!",n.style.display="block")}),document.getElementById("delete-tag").addEventListener("click",e=>{e.stopPropagation();e=document.getElementById("error-message");null!==selectedTagIndex?(tags.splice(selectedTagIndex,1),saveTagsToLocalStorage(),updateTagList(),updateTagDropdown(),selectedTagIndex=null,document.getElementById("tag-input").value="",document.getElementById("tag-color").value="#007BFF",e.style.display="none"):(e.textContent="Please select a tag to delete.",e.style.display="block")}),document.getElementById("tag-popup").addEventListener("click",()=>{document.getElementById("error-message").style.display="none"}),document.querySelectorAll("#tag-popup input, #tag-popup button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation()})}),document.addEventListener("DOMContentLoaded",()=>{updateTagList(),updateTagDropdown(),updatePinnedDocsList()}),document.getElementById("unpin-all").addEventListener("click",()=>{confirm("Are you sure you want to clear all pins and tags? This action cannot be undone. It is recommended you download the record of your pins and tags before proceeding. If you are sure you want to clear all the pins and tags, click delete.")&&(pinnedDocs=[],updatePinnedDocsList(),alert("All pins and tags have been cleared."))}),document.addEventListener("DOMContentLoaded",()=>{updateTagList(),updatePinnedDocsList()}),document.getElementById("zoom-in").addEventListener("click",()=>{"pdf"===fileArray[currentDocIndex].type?(zoomLevel=Math.min(zoomLevel+.25,3),renderPage(pageNum)):"image"===fileArray[currentDocIndex].type&&(zoomLevel=Math.min(zoomLevel+.25,3),adjustImageViewer())}),document.getElementById("zoom-out").addEventListener("click",()=>{"pdf"===fileArray[currentDocIndex].type?(zoomLevel=Math.max(zoomLevel-.25,.5),renderPage(pageNum)):"image"===fileArray[currentDocIndex].type&&(zoomLevel=Math.max(zoomLevel-.25,.5),adjustImageViewer())}),document.getElementById("rotate").addEventListener("click",()=>{rotationAngle=(rotationAngle+90)%360,"pdf"===fileArray[currentDocIndex].type?renderPage(pageNum):"image"===fileArray[currentDocIndex].type&&adjustImageViewer()}),document.getElementById("prev-page").addEventListener("click",()=>{1<pageNum&&renderPage(--pageNum)}),document.getElementById("next-page").addEventListener("click",()=>{pageNum<pageCount&&renderPage(++pageNum)}),document.getElementById("folder-select").addEventListener("click",()=>{document.getElementById("file-input").click()}),document.getElementById("file-input").addEventListener("change",n=>{let a=[],o=0;for(let t of n.target.files){var e=new FileReader;e.onload=function(e){e={name:t.name,type:getFileType(t.name),content:e.target.result};a.push(e),++o===n.target.files.length&&(fileArray=[...fileArray,...a],saveFilesToLocalStorage(),populateDocumentSelect(),0<a.length)&&loadDocument(fileArray.length-1)},e.readAsDataURL(t)}0<fileArray.length&&loadDocument(0)}),document.getElementById("remove-file").addEventListener("click",()=>{var e=document.getElementById("document-select"),e=parseInt(e.value);0<=e&&(fileArray.splice(e,1),saveFilesToLocalStorage(),populateDocumentSelect(),0<fileArray.length?loadDocument(0):hideAllViewers())}),document.addEventListener("DOMContentLoaded",()=>{loadFilesFromLocalStorage(),populateDocumentSelect(),0<fileArray.length&&loadDocument(0),updateTagList(),updatePinnedDocsList()}),document.getElementById("flag-doc").addEventListener("click",()=>{var e=fileArray[currentDocIndex];pinnedDocs.includes(e)||(pinnedDocs.push(e),updatePinnedDocsList())}),document.getElementById("export-list").addEventListener("click",()=>{if(0===pinnedDocs.length)alert("No pinned documents to export.");else{let o=[],e=(pinnedDocs.forEach(e=>{e.tags&&e.tags.forEach(t=>{o.some(e=>e.name===t.name)||o.push(t)})}),"data:text/csv;charset=utf-8,Document Name,"+o.map(e=>e.name).join(",")+"\n");pinnedDocs.forEach(n=>{let a=n.name+",";o.forEach(t=>{var e=!!n.tags&&n.tags.some(e=>e.name===t.name);a+=e?"1,":"0,"}),e+=a.slice(0,-1)+"\n"});var t=encodeURI(e),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","pinned_documents_with_tags.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}}),document.getElementById("prev-doc").addEventListener("click",()=>{0<currentDocIndex&&loadDocument(currentDocIndex-1)}),document.getElementById("next-doc").addEventListener("click",()=>{currentDocIndex<fileArray.length-1&&loadDocument(currentDocIndex+1)}),document.getElementById("search").addEventListener("click",()=>{let l=document.getElementById("search-text").value.toLowerCase(),d=document.getElementById("results-list"),c=(d.innerHTML="",!1),t=[];fileArray.forEach((a,o)=>{var e;"pdf"===a.type?(e=pdfjsLib.getDocument({data:atob(a.content.split(",")[1])}).promise.then(e=>e.getPage(1).then(e=>e.getTextContent().then(e=>{var t;e.items.map(e=>e.str).join(" ").toLowerCase().includes(l)&&(c=!0,e=document.createElement("li"),(t=document.createElement("a")).textContent=a.name,t.href="#",t.style.color="white",t.addEventListener("click",()=>loadDocument(o)),e.appendChild(t),d.appendChild(e))}))),t.push(e)):"txt"===a.type?(e=fetch(a.content).then(e=>e.text()).then(e=>{var t;e.toLowerCase().includes(l)&&(c=!0,e=document.createElement("li"),(t=document.createElement("a")).textContent=a.name,t.href="#",t.style.color="white",t.addEventListener("click",()=>loadDocument(o)),e.appendChild(t),d.appendChild(e))}),t.push(e)):"docx"===a.type?(e=fetch(a.content).then(e=>e.arrayBuffer()).then(e=>mammoth.extractRawText({arrayBuffer:e})).then(e=>{var t;e.value.toLowerCase().includes(l)&&(c=!0,e=document.createElement("li"),(t=document.createElement("a")).textContent=a.name,t.href="#",t.style.color="white",t.addEventListener("click",()=>loadDocument(o)),e.appendChild(t),d.appendChild(e))}),t.push(e)):"xlsx"===a.type&&(e=fetch(a.content).then(e=>e.arrayBuffer()).then(e=>{let n=XLSX.read(e,{type:"array"});n.SheetNames.forEach(e=>{var t,e=n.Sheets[e];XLSX.utils.sheet_to_csv(e).toLowerCase().includes(l)&&(c=!0,e=document.createElement("li"),(t=document.createElement("a")).textContent=a.name,t.href="#",t.style.color="white",t.addEventListener("click",()=>loadDocument(o)),e.appendChild(t),d.appendChild(e))})}),t.push(e))}),Promise.all(t).then(()=>{var e;c||((e=document.createElement("li")).textContent="No matches found",e.style.color="white",d.appendChild(e))})}),document.getElementById("search-doc").addEventListener("click",()=>{let o=document.getElementById("search-text").value.toLowerCase(),l=document.getElementById("results-list");if(l.innerHTML="","pdf"===fileArray[currentDocIndex].type){let a=[];for(let n=1;n<=pageCount;n++)pdfDoc.getPage(n).then(e=>{e.getTextContent().then(e=>{var t;e.items.map(e=>e.str).join(" ").toLowerCase().includes(o)&&(a.push(n),e=document.createElement("li"),(t=document.createElement("a")).textContent="Page "+n,t.href="#",t.style.color="white",t.addEventListener("click",()=>{renderPage(pageNum=n)}),e.appendChild(t),l.appendChild(e))})})}else"txt"===fileArray[currentDocIndex].type?fetch(fileArray[currentDocIndex].content).then(e=>e.text()).then(e=>{e.split("\n").forEach((e,t)=>{var n;e.toLowerCase().includes(o)&&((n=document.createElement("li")).textContent=`Line ${t+1}: `+e,n.style.color="white",l.appendChild(n))}),""===l.innerHTML&&(l.innerHTML="<li>No matches found</li>")}):l.innerHTML="<li>Search is not supported for this file type</li>"}),document.getElementById("search-text").addEventListener("keypress",e=>{"Enter"===e.key&&document.getElementById("search-doc").click()});