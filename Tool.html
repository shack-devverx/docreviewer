<!DOCTYPE html>
<!--documentreview.law © 2024 Adam J Schwartz, All Rights Reserved.-->
<!--You may not copy, reproduce, distribute, display, perform, exploit, or otherwise use in any way, whether in commerce or not, any portion of the documentreview.law Appplication without the express written consent of the owner, with the sole exception of use for a legitimate educational purpose (i.e., at or in association with an accredited educational institution), but only if the institution is a non-profit or similar entity and the use is non-commercial.-->
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>documentreview.law</title>
    <link rel="stylesheet" href="https://use.typekit.net/hdi0iou.css">

    <!-- Security logo script -->
    <script type="text/javascript"> 
        var tlJsHost = ((window.location.protocol === "https:") ? "https://secure.trust-provider.com/" : "http://www.trustlogo.com/");
        document.write(unescape("%3Cscript src='" + tlJsHost + "trustlogo/javascript/trustlogo.js' type='text/javascript'%3E%3C/script%3E"));
        </script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <!-- Mammoth.js (for Word documents) -->
    <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
    <!-- SheetJS (for Excel files) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
            background-color: rgba(52,50,62,1.00);
            display: flex;
            flex-direction: column;
        }
        #toolbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            color: white;
            padding: 10px;
            z-index: 2;
            background-color: rgba(0, 0, 0, 0.3);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            font-family: "apparat", serif;
font-weight: 700;
font-style: normal;
        padding-bottom: 20px;

        }
        #docreview-logo {
            position: absolute;
            bottom: 50px; /* Provide enough space for the security logo beneath */
            right: 20px;
            z-index: 1000;
            border-radius: 10px;
        }
        #docreview-logo img {
            border-radius: 10px;
            width: 250px;
        }
        #content {
            display: flex;
            height: calc(100% - 50px);
            overflow: hidden;
            padding-top: 40px;
        }
        #main-content {
            flex-grow: 1;
            overflow: auto;
            position: relative;
            text-align: center;
        }
        #pdf-viewer, #docx-viewer, #xlsx-viewer, #txt-viewer, #image-viewer {
            width: 8.5in;
            height: 11in;
            margin: auto;
            padding: 40px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            display: none;
        }
        #pdf-viewer canvas {
            width: 100%;
            height: 100%;
        }
        #docx-viewer, #xlsx-viewer, #txt-viewer {
            background-color: white;
            overflow-y: auto;
            text-align: left;
        }
        #image-viewer {
            max-width: 100%;
            max-height: 100%;
            transform-origin: center;
            transition: transform 0.2s ease;
        }
        #pdf-viewer, #docx-viewer, #xlsx-viewer, #txt-viewer, #image-viewer {
            z-index: 10; /* Ensure viewers have a lower z-index */
        }
        #security-logo {
            position: absolute;
            bottom: 10px; /* Directly beneath the docreview logo */
            right: 20px;
            z-index: 1000;
            display: block;
        }
        #security-logo img {
            width: 100px; /* Adjust size as necessary */
        }
        button, select, {
            padding: 0px 2px;
            margin: 2px;
            border-radius: 4px;
            font-size: 16px;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
text-align: center;
        }
         input[type="text"] {padding: 0px 2px;
            margin: 2px;
            border-radius: 4px;
            background-color: rgba(255,255,255,.4);
            font-size: 16px;
            color: rgba(255,255,255,.8);
            font-family: "apparat-light", serif;
font-weight: 700;
font-style: normal;
        }
        button { width: 35px; border: 2px solid rgba(255,255,255,.8); border-radius:4px; background-color: rgba(255,255,255,.5); font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal; font-size:12px; text-align: center;}
        button:hover {
            background-color: rgba(255,255,255,.8);
        }
        button:active {
            background-color: rgba(255,255,255,.3);
        }
        ::placeholder {
            color: rgba(255,255,255,.8);
            font-family: "apparat-light", serif;
font-weight: 700;
font-style: normal;
            opacity: 1; /* Firefox */
        }
        ::-ms-input-placeholder { /* Edge 12 -18 */
        font-family: "apparat-light", serif;
font-weight: 700;
font-style: normal;
          color: white;
        }
        #search-text {
            border: 2px solid white;
            font-family: "apparat-light", serif;
font-weight: 700;
font-style: normal;
        }
        #document-select {
            border: 2px solid white;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
        }
        #search-results-container {
            display: flex;
            flex-direction: column;
            width: 250px;
            overflow: auto;
            padding: 20px;
            border-left: 1px solid rgba(255,255,255,.8);
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
            color: rgba(255,255,255,.8);
            background-color: rgba(52, 50, 62, 1);
            position: relative;
        }
        #search-results, #pinned-docs {
            flex-grow: 1;
            max-height: 50vh; /* Set max height to 50% of the viewport height */
            overflow-y: auto;
            margin-bottom: 20px;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
        }
        a {
            color: white;
            text-decoration: underline;
            cursor: pointer;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
        }
        a:hover {
            color: yellow;
        }
        /* Help window */
        #help-window {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 350px;
            padding: 10px 30px 10px 30px;
            background-color: rgba(255,255,255,1);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            color: #222222;
            border-radius: 10px;
            display: none; /* Hidden by default */
            z-index: 10000;
            text-align: center;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
        }
        button:disabled {
            background-color: rgba(255,255,255,.3);
            border: 2px solid rgba(255,255,255,.3);
            cursor: not-allowed;
        }
        #help-window ul {
            text-align: left;
            list-style-type: none;
            padding: 0;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
        }
        #help-window ul li {
            text-align: left;
            margin-bottom: 10px;
            font-family: "apparat-light", serif;
font-weight: 400;
font-style: normal;
        }
        #tag-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #FFF;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            width: 300px;
            z-index: 10;
            font-family: Arial, sans-serif;
            display: none;
        }

        /* Title Styling */
        #tag-popup h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 18px;
            color: #333;
        }

        /* Popup Content */
        .popup-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Buttons */
        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px; /* Adjusted size */
            transition: transform 0.3s ease;
            color: #555;
            display: flex;
            align-items: center;
        }

        .icon-button:hover {
            transform: scale(1.2);
        }

        /* Close Button */
        .close-btn {
            font-size: 18px; /* Slightly smaller size */
            position: absolute;
            right: 10px;
            top: 10px;
            cursor: pointer;
            color: #ff3333;
        }

        /* Input Fields */
        #tag-input {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            color: black; /* Text color is black */
        }

        #tag-color {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        /* Tag List Styling */
        #tag-list {
            padding: 0;
            margin: 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        #tag-list li {
            background-color: #007BFF;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Selected Tag Border */
        #tag-list li.selected {
            border: 2px solid #333;
        }

        /* Hover Effects */
        #tag-list li:hover {
            background-color: #0056b3;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            #tag-popup {
                width: 90%;
            }
        }

        /* Style for assigned tags in pinned documents */
        .assigned-tag {
            display: inline-block;
            text-align: left;
            padding: 2px 5px;
            margin-right: 5px;
            margin-bottom: 4px;
            border: 1px solid black;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <button id="folder-select">&#x1F4C2;</button>
        <input type="file" id="file-input" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.rtf,.jpeg,.jpg,.png,.gif,.tiff" style="display: none; text-size: 36px;">&nbsp;&nbsp;
        <button id="prev-doc">&#x23ee;</button>
        <select id="document-select" style="min-width: 140px; max-width: 140px;"></select>
        <button id="next-doc">&#x23ed;</button>&nbsp;&nbsp;
        <button id="prev-page">&#x25c0;</button>
        <span style="padding-top:3px; font-weight: 700; text-decoration: underline;">Page: <span id="page-num"></span> / <span id="page-count"></span></span>
        <button id="next-page">&#x25b6;</button>&nbsp;&nbsp;
        <button id="zoom-out">&#x2796;</button>
        <button id="zoom-in">&#x2795;</button>
        <button id="rotate">&#x1F504;</button>&nbsp;&nbsp;
        <input type="text" id="search-text" placeholder="Search...">
        <button id="search-doc">&#128270;</button>
        <button id="search" style="width:60px;">&#128270;&#128270;</button>&nbsp;&nbsp;
        <!-- <button id="flag-doc">&#x1f4cc;</button> -->
        <button id="flag-doc"><?xml version="1.0" encoding="utf-8"?>
            <!-- License: PD. Made by stephenhutchings: https://github.com/stephenhutchings/typicons.font -->
            <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#a)"><path d="M.826 16c-.37-.16-.43-.43-.18-.75 1.15-1.45 2.37-2.84 3.69-4.13.63-.62 1.25-1.24 1.88-1.88-.04-.05-.08-.09-.12-.13-.82-.83-1.65-1.65-2.47-2.48-.26-.26-.26-.49.01-.74.7-.64 1.75-.69 2.51-.11.03.03.07.05.11.08l4.66-4c-.15-.29-.21-.59-.16-.91.05-.34.2-.62.45-.85.14-.13.35-.13.51-.02.04.03.07.06.11.09 1.45 1.45 2.9 2.9 4.36 4.35.13.13.21.26.15.45a.5.5 0 0 1-.11.2c-.41.43-1.07.55-1.61.31-.08-.03-.13-.05-.2.03-1.29 1.51-2.59 3.02-3.89 4.53-.01.02-.02.03-.04.06.28.34.46.72.48 1.16.04.6-.16 1.1-.58 1.53-.18.19-.43.17-.64-.03-.79-.78-1.57-1.57-2.35-2.35-.04-.04-.07-.09-.11-.15-.07.06-.11.11-.16.15-1.31 1.29-2.57 2.63-3.96 3.84-.64.56-1.3 1.09-1.96 1.63-.07.05-.15.09-.23.13h-.16z" fill="#FF000D"/></g><defs><clipPath id="a"><path fill="#fff" d="M.496 0h15.85v16H.496z"/></clipPath></defs></svg>
        
        </button>
        <button id="add-tag" >
            
            <svg width="18" height="18" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#a)"><path d="M.692 9.136v-.329c.071-.402.317-.692.597-.971 2.319-2.311 4.632-4.63 6.954-6.94.165-.165.378-.286.583-.403.125-.073.276-.1.417-.147h5.62c.014.006.026.016.041.019.692.137 1.095.626 1.095 1.337q.002 2.577 0 5.155c0 .457-.162.864-.483 1.187q-3.591 3.602-7.198 7.193c-.143.143-.33.265-.52.334-.54.197-1.002.033-1.398-.364q-2.549-2.554-5.105-5.103c-.28-.278-.529-.566-.602-.968zm11.463-3.689c.679.026 1.265-.544 1.292-1.257.026-.68-.543-1.265-1.257-1.292-.68-.025-1.278.543-1.29 1.258-.01.673.495 1.26 1.255 1.292" fill="#FF000D"/></g><defs><clipPath id="a"><path fill="#fff" d="M.346 0h16v16h-16z"/></clipPath></defs></svg>
        
        </button>
        <button id="export-list" style="width:35px;">
            
            <svg width="20" height="20" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill="#FF000D" fill-rule="evenodd" d="M14 9a1 1 0 0 1 1 1v3a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-3a1 1 0 0 1 2 0v3h10v-3a1 1 0 0 1 1-1M8 1a1 1 0 0 1 1 1v4.586l1.293-1.293a1 1 0 1 1 1.414 1.414L8 10.414 4.293 6.707a1 1 0 0 1 1.414-1.414L7 6.586V2a1 1 0 0 1 1-1"/></svg>
        
        </button>
        <button id="unpin-all" title="Unpin All Documents">

            <svg fill="#FF000D" width="16" height="16" viewBox="-3 -2 24 24" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin" class="jam jam-trash-f"><path d="M12 2h5a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h5V1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1zm3.8 6-.613 9.2a3 3 0 0 1-2.993 2.8H5.826a3 3 0 0 1-2.993-2.796L2.205 8zM7 9a1 1 0 0 0-1 1v7a1 1 0 0 0 2 0v-7a1 1 0 0 0-1-1m4 0a1 1 0 0 0-1 1v7a1 1 0 0 0 2 0v-7a1 1 0 0 0-1-1"/></svg>

        </button>
        <button id="help-button">

            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.313 0C5.82 0 4.203 1.022 2.935 2.845a.75.75 0 0 0 .162 1.027l1.348 1.022a.75.75 0 0 0 1.039-.13c.783-.98 1.363-1.545 2.586-1.545.961 0 2.15.619 2.15 1.551 0 .705-.581 1.067-1.53 1.599-1.107.62-2.572 1.393-2.572 3.325V10c0 .414.335.75.75.75h2.264a.75.75 0 0 0 .75-.75v-.18c0-1.34 3.915-1.396 3.915-5.02 0-2.73-2.831-4.8-5.484-4.8M8 11.67a2.167 2.167 0 0 0-2.165 2.165C5.835 15.03 6.806 16 8 16a2.167 2.167 0 0 0 2.165-2.165A2.167 2.167 0 0 0 8 11.671" fill="#FF000D"/></svg>
        
        </button>&nbsp;
        
    </div>

    <div id="content">
        <div id="main-content">
            <div id="pdf-viewer">
                <canvas id="pdf-canvas"></canvas>
            </div>
            <div id="docx-viewer"></div>
            <div id="xlsx-viewer"></div>
            <div id="txt-viewer"></div>
            <img id="image-viewer"/>
        </div>
        <div id="search-results-container">
            <div id="search-results">
                <h4 style="text-decoration: underline;">Search Results</h4>
                <ul id="results-list"></ul>
            </div>
            <div id="pinned-docs">
                <h4 style="text-decoration: underline;">Pinned Documents</h4>
                <ul id="pinned-list"></ul>
            </div>
            <div id="docreview-logo">
                <img src="https://documentreview.law/lebel-investigations/IMG_1112.jpg" alt="Doc Review Logo">
            </div>
            <div id="security-logo">
                <img src="IMG_1139.png" alt="Security Logo">
            </div>
        </div>
    </div>

    <!-- Add this new div for tag management popup -->
    <div id="tag-popup">
        <h3>Manage Tags
            <button id="close-tag-popup" class="icon-button close-btn">❌</button>
        </h3>
        <div class="popup-content">
            <input type="text" id="tag-input" placeholder="Enter tag name">
            <input type="color" id="tag-color" value="#007BFF">
            <span id="error-message" style="color: red; display: none;"></span>
            <div class="button-group">
                <button id="save-tag" class="icon-button save-btn">
                    <span style="color:green;">✔</span>
                </button>
                <button id="delete-tag" class="icon-button delete-btn"><svg fill="#FF000D" width="16" height="16" viewBox="-3 -2 24 24" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin" class="jam jam-trash-f"><path d="M12 2h5a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h5V1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1zm3.8 6-.613 9.2a3 3 0 0 1-2.993 2.8H5.826a3 3 0 0 1-2.993-2.796L2.205 8zM7 9a1 1 0 0 0-1 1v7a1 1 0 0 0 2 0v-7a1 1 0 0 0-1-1m4 0a1 1 0 0 0-1 1v7a1 1 0 0 0 2 0v-7a1 1 0 0 0-1-1"/></svg></button>
            </div>
            <ul id="tag-list"></ul>
        </div>
    </div>

    <!-- Help window content -->
    <div id="help-window">
        <h5 style="font-size:18px; margin: 10px 0; padding: 0;">We're here to help! Have a question not answered below?</h5><a href="https://documentreview.law/contact/" target="_new" style="color:#0bd14b; font-weight: 600; text-align:center; font-size:18px;">Contact Us Here.</a>
        <ul>
            <li>&#x1F4C2; - Open Folder/Files</li>
            <li>&#x23ee; - Previous Document</li>
            <li>&#x23ed; - Next Document</li>
            <li>&#x25c0; - Previous Page<sup>*</sup></li>
            <li>&#x25b6; - Next Page<sup>*</sup></li>
            <li> &#x2796; / &#x2795;  - Zoom<sup>*</sup></li>
            <li>&#x1F504; - Rotate<sup>*</sup></li>
            <li>&#128270; - Search Within Document</li>
            <li>&#128270;&#128270; - Search Across Documents</li>
            <li>&#x1f4cc; - Pin Document</li>
            <li>&#x1f4cc;&#x2b07; - Export List of Pinned Docs (.csv)</li><br>
            <li><sup>*</sup>&nbsp;<i>Only for PDFs and Image Files</i></li>
        </ul>
        <div style="text-align: center; padding: 0; margin: 0;">
    <button id="close-help" style="color:#0bd14b; font-weight: 600; font-size:18px; background:none; border:none; cursor:pointer; text-decoration: underline; padding: 0; margin: 0;">Close</button>
</div>
    </div>
    <script>
    // Copyright alert
    alert('ATTN USER: select the folder button on the toolbar to choose a local folder of documents and images for review. This is a CONFIDENTIAL PROTOTYPE for demonstration purposes only. No other use is permitted. © 2024 Adam J Schwartz, All Rights Reserved');

        // Help button functionality
        document.getElementById('help-button').addEventListener('click', function() {
            const helpWindow = document.getElementById('help-window');
            helpWindow.style.display = 'block';
        });

        // Close help window
        document.getElementById('close-help').addEventListener('click', function() {
            const helpWindow = document.getElementById('help-window');
            helpWindow.style.display = 'none';
        });

        let pdfDoc = null,
            pageNum = 1,
            pageCount = 0,
            zoomLevel = 1.25,
            rotationAngle = 0,
            currentDocIndex = 0,
            canvas = document.getElementById('pdf-canvas'),
            ctx = canvas.getContext('2d'),
            fileArray = [],
            pinnedDocs = JSON.parse(localStorage.getItem('pinnedDocs')) || [];

        let tags = JSON.parse(localStorage.getItem('tags')) || [];
        let selectedTagIndex = null;

        // Show the tag popup when Add Tag button is clicked
        document.getElementById('add-tag').addEventListener('click', () => {
            document.getElementById('tag-popup').style.display = 'block';
            document.getElementById('tag-input').value = '';
            document.getElementById('tag-color').value = '#007BFF';
            document.getElementById('error-message').style.display = 'none';  // Hide error message on popup open
            selectedTagIndex = null;
            updateTagList();
        });

        // Close the tag popup when the close button is clicked
        document.getElementById('close-tag-popup').addEventListener('click', () => {
            document.getElementById('tag-popup').style.display = 'none';
        });

        // Save a new or edited tag with color
        document.getElementById('save-tag').addEventListener('click', (event) => {
            event.stopPropagation();  // Prevent closing the alert on button click
            const tagName = document.getElementById('tag-input').value.trim();
            const tagColor = document.getElementById('tag-color').value;
            const errorMessage = document.getElementById('error-message');

            // Prevent empty tag creation
            if (!tagName) {
                errorMessage.textContent = "Tag name can't be empty!";
                errorMessage.style.display = 'block';
                return;
            }

            // Check if the maximum number of tags has been reached
            if (tags.length >= 9 && selectedTagIndex === null) {
                errorMessage.textContent = "You can only create a maximum of 9 tags.";
                errorMessage.style.display = 'block';
                return;
            }

            // Check for duplicates
            const tagExists = tags.some(tag => tag.name.toLowerCase() === tagName.toLowerCase());
            if (tagExists && selectedTagIndex === null) {
                errorMessage.textContent = "A tag with this name already exists.";
                errorMessage.style.display = 'block';
                return;
            }

            // Clear error message upon successful tag creation
            errorMessage.style.display = 'none';

            if (selectedTagIndex !== null) {
                // Update the selected tag
                tags[selectedTagIndex] = { name: tagName, color: tagColor };
            } else {
                // Add a new tag
                tags.push({ name: tagName, color: tagColor });
            }

            saveTagsToLocalStorage();
            document.getElementById('tag-input').value = '';
            document.getElementById('tag-color').value = '#007BFF';
            selectedTagIndex = null;
            updateTagList();
            updateTagDropdown();
        });

        // Delete the selected tag when trash icon is clicked
        document.getElementById('delete-tag').addEventListener('click', (event) => {
            event.stopPropagation();  // Prevent closing the alert on button click
            const errorMessage = document.getElementById('error-message');

            if (selectedTagIndex !== null) {
                tags.splice(selectedTagIndex, 1);
                saveTagsToLocalStorage();
                updateTagList();
                updateTagDropdown();
                selectedTagIndex = null;
                document.getElementById('tag-input').value = '';
                document.getElementById('tag-color').value = '#007BFF';
                errorMessage.style.display = 'none';  // Clear any previous error message
            } else {
                errorMessage.textContent = "Please select a tag to delete.";
                errorMessage.style.display = 'block';
            }
        });

        // Function to hide the alert when clicking anywhere in the pop-up
        document.getElementById('tag-popup').addEventListener('click', () => {
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'none';  // Hide the error message
        });

        // Function to prevent hiding the alert when clicking on input fields or buttons
        document.querySelectorAll('#tag-popup input, #tag-popup button').forEach(element => {
            element.addEventListener('click', (event) => {
                event.stopPropagation();  // Prevent event bubbling to the parent
            });
        });

        // Function to update the displayed tag list
        function updateTagList() {
            const tagList = document.getElementById('tag-list');
            tagList.innerHTML = '';  // Clear previous list

            tags.forEach((tag, index) => {
                const li = document.createElement('li');
                li.textContent = tag.name;
                li.style.backgroundColor = tag.color;
                li.style.color = getContrastColor(tag.color);

                // Add click event to toggle the selected state
                li.addEventListener('click', (event) => {
                    event.stopPropagation();  // Prevent closing the alert when clicking on tags

                    // Remove 'selected' class from all tags
                    document.querySelectorAll('#tag-list li').forEach(item => item.classList.remove('selected'));

                    // Add 'selected' class to the clicked tag
                    li.classList.add('selected');
                    selectedTagIndex = index;

                    // Update input fields with selected tag data
                    document.getElementById('tag-input').value = tag.name;
                    document.getElementById('tag-color').value = tag.color;
                });

                tagList.appendChild(li);
            });
        }

        // Helper function to determine text color based on background
        function getContrastColor(hexcolor) {
            hexcolor = hexcolor.replace('#', '');
            const r = parseInt(hexcolor.substr(0, 2), 16);
            const g = parseInt(hexcolor.substr(2, 2), 16);
            const b = parseInt(hexcolor.substr(4, 2), 16);
            const yiq = (r * 299 + g * 587 + b * 114) / 1000;
            return yiq >= 128 ? 'black' : 'white';
        }

        // Save tags to local storage
        function saveTagsToLocalStorage() {
            localStorage.setItem('tags', JSON.stringify(tags));
        }

        // Function to update the dropdown dynamically with the latest tags
        function updateTagDropdown() {
            document.querySelectorAll('.tag-dropdown').forEach(dropdown => {
                dropdown.innerHTML = '<option value="">Select Tag</option>';
                tags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag.name;
                    option.textContent = tag.name;
                    dropdown.appendChild(option);
                });
            });
        }

        // Load tags from local storage when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            updateTagList();
            updateTagDropdown();
            updatePinnedDocsList();
        });

        // Update the list of pinned documents
        function updatePinnedDocsList() {
            const pinnedList = document.getElementById('pinned-list');
            pinnedList.innerHTML = ''; // Clear previous list

            pinnedDocs.forEach((doc, index) => {
                const li = document.createElement('li');
                li.textContent = doc.name;

                // Create the individual unpin button using the embedded SVG icon
                const unpinButton = document.createElement('span');
                unpinButton.innerHTML = `
                    <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_37_74)">
                <path d="M10.4311 11.3185C10.4646 11.8915 10.2757 12.3813 9.87167 12.7866C9.69514 12.9643 9.45523 12.9494 9.2613 12.7555C8.50674 12.0022 7.75342 11.2476 7.00009 10.493C6.96156 10.4558 6.93297 10.406 6.89319 10.3526C6.82606 10.4147 6.78379 10.4545 6.74153 10.4943C5.48475 11.7361 4.27397 13.0252 2.93887 14.1851C2.32353 14.7208 1.68582 15.2293 1.05557 15.7476C0.990926 15.7999 0.908882 15.8322 0.836781 15.8744H0.686366C0.333324 15.7228 0.271169 15.4592 0.51606 15.151C1.61994 13.755 2.79219 12.4223 4.06388 11.1755C4.66803 10.585 5.26223 9.98213 5.8726 9.37301C5.83033 9.32701 5.79428 9.28848 5.75699 9.25118C4.96389 8.45808 4.17079 7.66498 3.37769 6.87188C3.12409 6.61829 3.12782 6.39702 3.39012 6.1571C4.06512 5.53679 5.07701 5.49452 5.80174 6.05516C5.83282 6.08002 5.8639 6.10489 5.90368 6.13472C6.27661 5.814 6.64954 5.49452 7.02247 5.17504L10.9258 9.07839C10.6188 9.43516 10.3142 9.79193 10.0072 10.1475C9.99473 10.1624 9.98479 10.1798 9.96863 10.2034C10.2421 10.5254 10.4062 10.8946 10.4311 11.3172V11.3185Z" fill="#FF000D" stroke="#FF000D" stroke-width="0.248621" stroke-miterlimit="10"/>
                <path d="M16.4812 4.77476C16.4613 4.84314 16.4265 4.91648 16.3768 4.96745C15.9852 5.37767 15.3512 5.49949 14.8266 5.26952C14.752 5.2372 14.7048 5.21855 14.6377 5.29687C13.7004 6.39329 12.7606 7.48722 11.822 8.58115L7.9187 4.6778C9.03874 3.71688 10.1588 2.75472 11.2838 1.78883C11.1433 1.51037 11.0836 1.22321 11.1309 0.914925C11.1806 0.589232 11.3248 0.318235 11.5622 0.0944759C11.694 -0.0285915 11.9016 -0.0323208 12.0483 0.0721C12.0856 0.0982052 12.1179 0.129283 12.1502 0.161604C13.545 1.55512 14.9398 2.94989 16.3358 4.34465C16.4563 4.46523 16.5334 4.59949 16.4824 4.77228L16.4812 4.77476Z" fill="#FF000D" stroke="#FF000D" stroke-width="0.248621" stroke-miterlimit="10"/>
                <path d="M14.5382 11.4975L4.23657 1.44822" stroke="#FF000D" stroke-width="0.745863" stroke-miterlimit="10" stroke-linecap="round"/>
                </g>
                <defs>
                <clipPath id="clip0_37_74">
                <rect width="16.2523" height="16" fill="white" transform="translate(0.243774)"/>
                </clipPath>
                </defs>
                </svg>
                `;
                unpinButton.style.cursor = 'pointer';
                unpinButton.style.marginLeft = '10px';
                unpinButton.addEventListener('click', () => {
                    // Unpin only this specific document
                    unpinDocument(index);
                });

                // Create the tag dropdown
                const dropdown = document.createElement('select');
                dropdown.classList.add('tag-dropdown');
                dropdown.innerHTML = '<option value="">Select Tag</option>';
                tags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag.name;
                    option.textContent = tag.name;
                    dropdown.appendChild(option);
                });
                dropdown.addEventListener('change', () => {
                    const selectedTag = tags.find(tag => tag.name === dropdown.value);
                    if (selectedTag) {
                        addTagToDocument(doc, selectedTag);
                    }
                    dropdown.value = ''; // Reset dropdown after selection
                });

                // Create tag container
                const tagContainer = document.createElement('div');
                tagContainer.style.marginTop = '5px';
                if (doc.tags) {
                    doc.tags.forEach(assignedTag => {
                        const tagSpan = document.createElement('span');
                        tagSpan.textContent = assignedTag.name;
                        tagSpan.className = 'assigned-tag';
                        tagSpan.style.backgroundColor = assignedTag.color;
                        tagSpan.style.color = getContrastColor(assignedTag.color);

                        const removeIcon = document.createElement('span');
                        removeIcon.textContent = '✖';
                        removeIcon.style.marginLeft = '5px';
                        removeIcon.style.cursor = 'pointer';
                        removeIcon.addEventListener('click', () => removeTagFromDocument(doc, assignedTag));

                        tagSpan.appendChild(removeIcon);
                        tagContainer.appendChild(tagSpan);
                    });
                }

                li.appendChild(unpinButton);
                li.appendChild(dropdown);
                li.appendChild(tagContainer);
                pinnedList.appendChild(li);
            });

            savePinnedDocsToLocalStorage();
        }

        // Unpin a specific document
        function unpinDocument(index) {
            pinnedDocs.splice(index, 1); // Remove the document at the given index
            updatePinnedDocsList(); // Refresh the pinned list display
        }

        // Global Unpin Button - remove all pinned documents
        document.getElementById('unpin-all').addEventListener('click', () => {
            // Show a confirmation prompt
            const confirmUnpin = confirm("Are you sure you want to clear all pins and tags? This action cannot be undone. It is recommended you download the record of your pins and tags before proceeding. If you are sure you want to clear all the pins and tags, click delete.");

            if (confirmUnpin) {
                // If confirmed, clear all pinned documents and tags
                pinnedDocs = []; // Clear the pinned documents array
                updatePinnedDocsList(); // Refresh the pinned list display
                alert("All pins and tags have been cleared.");
            }
        });

        // Add tag to a document
        function addTagToDocument(doc, tag) {
            if (!doc.tags) doc.tags = [];
            if (!doc.tags.some(t => t.name === tag.name)) {
                doc.tags.push(tag);
                updatePinnedDocsList();
            }
        }

        // Remove tag from a document
        function removeTagFromDocument(doc, tag) {
            doc.tags = doc.tags.filter(t => t.name !== tag.name);
            updatePinnedDocsList();
        }

        // Save pinned documents to local storage
        function savePinnedDocsToLocalStorage() {
            localStorage.setItem('pinnedDocs', JSON.stringify(pinnedDocs));
        }

        // Load the tags and pinned documents when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            updateTagList();
            updatePinnedDocsList();
        });

        // Load selected document
function loadDocument(index) {
    if (index < 0 || index >= fileArray.length) return;
    currentDocIndex = index;
    const file = fileArray[index];

    // Hide all viewers before loading a new document
    hideAllViewers();

    // Determine if the file is a PDF, image, or other document type
    const isPDF = file.type === 'pdf';
    const isImage = file.type === 'image';

    // Enable or disable navigation, zoom, and rotate buttons based on the file type
    document.getElementById('prev-page').disabled = !isPDF; // Disable page navigation for non-PDFs
    document.getElementById('next-page').disabled = !isPDF; // Disable page navigation for non-PDFs
    document.getElementById('zoom-in').disabled = !(isPDF || isImage); // Enable for PDFs and images only
    document.getElementById('zoom-out').disabled = !(isPDF || isImage); // Enable for PDFs and images only
    document.getElementById('rotate').disabled = !(isPDF || isImage); // Enable for PDFs and images only

    if (isPDF) {
        displayPDF(file.url);
    } else if (file.type === 'docx') {
        displayDocx(file.url);
    } else if (file.type === 'xlsx') {
        displayXlsx(file.url);
    } else if (file.type === 'txt') {
        displayTxtFile(file.url);
    } else if (isImage) {
        displayImage(file.url);
    }

    document.getElementById('document-select').value = index;
}



        // Hide all viewers
        function hideAllViewers() {
            document.getElementById('pdf-viewer').style.display = 'none';
            document.getElementById('docx-viewer').style.display = 'none';
            document.getElementById('xlsx-viewer').style.display = 'none';
            document.getElementById('txt-viewer').style.display = 'none';
            document.getElementById('image-viewer').style.display = 'none';
        }

        // Display PDF files
        function displayPDF(fileUrl) {
            document.getElementById('pdf-viewer').style.display = 'block';
            pdfjsLib.getDocument(fileUrl).promise.then(pdfDoc_ => {
                pdfDoc = pdfDoc_;
                pageCount = pdfDoc.numPages;
                document.getElementById('page-count').textContent = pageCount;
                pageNum = 1; 
                rotationAngle = 0; 
                renderPage(pageNum);
            });
        }
        // Display Word documents (.docx) using Mammoth.js
        function displayDocx(fileUrl) {
            document.getElementById('docx-viewer').style.display = 'block';
            fetch(fileUrl)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => mammoth.convertToHtml({ arrayBuffer }))
                .then(result => {
                    document.getElementById('docx-viewer').innerHTML = result.value;
                })
                .catch(console.error);
        }
        // Display Excel documents (.xlsx) using SheetJS
        function displayXlsx(fileUrl) {
            document.getElementById('xlsx-viewer').style.display = 'block';
            fetch(fileUrl)
                .then(response => response.arrayBuffer())
                .then(data => {
                    const workbook = XLSX.read(data, { type: 'array' });
                    const html = XLSX.utils.sheet_to_html(workbook.Sheets[workbook.SheetNames[0]]);
                    document.getElementById('xlsx-viewer').innerHTML = html;
                })
                .catch(console.error);
        }
        // Display text (.txt) files
        function displayTxtFile(fileUrl) {
            document.getElementById('txt-viewer').style.display = 'block';
            fetch(fileUrl)
                .then(response => response.text())
                .then(text => {
                    document.getElementById('txt-viewer').innerText = text;
                })
                .catch(console.error);
        }
        // Display images
        function displayImage(fileUrl) {
            document.getElementById('image-viewer').style.display = 'block';
            document.getElementById('image-viewer').src = fileUrl;
        }
        // Function to render a PDF page with zoom and rotation
function renderPage(num) {
    pdfDoc.getPage(num).then(page => {
        const viewport = page.getViewport({ scale: zoomLevel, rotation: rotationAngle });

        // Adjust the canvas size based on the new viewport (to prevent squishing)
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        // Adjust the container's dimensions to fit the rotated/zoomed canvas
        canvas.style.width = `${viewport.width}px`;
        canvas.style.height = `${viewport.height}px`;

        const renderContext = {
            canvasContext: ctx,
            viewport: viewport
        };
        page.render(renderContext).promise.then(() => {
            document.getElementById('page-num').textContent = num;
        });
    });
}

// Zoom In and Zoom Out functions
document.getElementById('zoom-in').addEventListener('click', () => {
    if (fileArray[currentDocIndex].type === 'pdf') {
        zoomLevel = Math.min(zoomLevel + 0.25, 3);  // Max zoom level is 3
        renderPage(pageNum);
    } else if (fileArray[currentDocIndex].type === 'image') {
        zoomLevel = Math.min(zoomLevel + 0.25, 3);  // Max zoom level for images
        adjustImageViewer();
    }
});

document.getElementById('zoom-out').addEventListener('click', () => {
    if (fileArray[currentDocIndex].type === 'pdf') {
        zoomLevel = Math.max(zoomLevel - 0.25, 0.5);  // Min zoom level is 0.5
        renderPage(pageNum);
    } else if (fileArray[currentDocIndex].type === 'image') {
        zoomLevel = Math.max(zoomLevel - 0.25, 0.5);  // Min zoom level for images
        adjustImageViewer();
    }
});

    // Rotate function
    document.getElementById('rotate').addEventListener('click', () => {
        rotationAngle = (rotationAngle + 90) % 360;  // Rotate by 90 degrees clockwise
        if (fileArray[currentDocIndex].type === 'pdf') {
            renderPage(pageNum);  // Re-render the page after rotation
        } else if (fileArray[currentDocIndex].type === 'image') {
            adjustImageViewer();  // Rotate image
        }
    });
    // Function to adjust the image viewer with zoom and rotation
    function adjustImageViewer() {
    const imageViewer = document.getElementById('image-viewer');
    imageViewer.style.transform = `scale(${zoomLevel}) rotate(${rotationAngle}deg)`;
    imageViewer.style.maxWidth = `${100 * zoomLevel}%`;
    imageViewer.style.maxHeight = `${100 * zoomLevel}%`;
}
        // Page navigation for PDFs
        document.getElementById('prev-page').addEventListener('click', () => {
            if (pageNum > 1) {
                pageNum--;
                renderPage(pageNum);
            }
        });

        document.getElementById('next-page').addEventListener('click', () => {
            if (pageNum < pageCount) {
                pageNum++;
                renderPage(pageNum);
            }
        });

        // Implement folder select button
        document.getElementById('folder-select').addEventListener('click', () => {
            document.getElementById('file-input').click();  // Trigger file input click
        });

        // Handle file uploads
        document.getElementById('file-input').addEventListener('change', (event) => {
            fileArray = [];
            for (const file of event.target.files) {
                const url = URL.createObjectURL(file);
                let type = '';

                if (file.name.endsWith('.pdf')) {
                    type = 'pdf';
                } else if (/\.(docx)$/i.test(file.name)) {
                    type = 'docx';
                } else if (/\.(xlsx)$/i.test(file.name)) {
                    type = 'xlsx';
                } else if (file.name.endsWith('.txt')) {
                    type = 'txt';
                } else if (/\.(jpeg|jpg|png|gif|tiff)$/i.test(file.name)) {
                    type = 'image';
                }

                fileArray.push({ name: file.name, url: url, type: type });
            }

            populateDocumentSelect();
            if (fileArray.length > 0) {
                loadDocument(0); // Load the first document by default
            }
        });

        // Populate dropdown with documents
        function populateDocumentSelect() {
            const docSelect = document.getElementById('document-select');
            docSelect.innerHTML = ''; // Clear previous options
            fileArray.sort((a, b) => a.name.localeCompare(b.name));
            fileArray.forEach((file, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = file.name;
                docSelect.appendChild(option);
            });

            // Add event listener for dropdown selection
            docSelect.addEventListener('change', (event) => {
                loadDocument(parseInt(event.target.value));
            });
        }

        // Implement document pinning
        document.getElementById('flag-doc').addEventListener('click', () => {
            const currentDoc = fileArray[currentDocIndex];
            if (!pinnedDocs.includes(currentDoc)) {
                pinnedDocs.push(currentDoc);
                updatePinnedDocsList();
            }
        });

        // Update the export function to create separate columns for each tag
        document.getElementById('export-list').addEventListener('click', () => {
            if (pinnedDocs.length === 0) {
                alert("No pinned documents to export.");
                return;
            }

            // Step 1: Collect all unique tags from all documents
            let uniqueTags = [];
            pinnedDocs.forEach(doc => {
                if (doc.tags) {
                    doc.tags.forEach(tag => {
                        if (!uniqueTags.some(t => t.name === tag.name)) {
                            uniqueTags.push(tag);
                        }
                    });
                }
            });

            // Step 2: Start CSV content with header row
            let csvContent = "data:text/csv;charset=utf-8,Document Name," + uniqueTags.map(tag => tag.name).join(',') + "\n";

            // Step 3: Loop through each pinned document
            pinnedDocs.forEach(doc => {
                // Start the row with the document name
                let row = `${doc.name},`;

                // Step 4: For each tag in the uniqueTags list, add '1' or '0' depending on whether it's applied to the document
                uniqueTags.forEach(tag => {
                    const hasTag = doc.tags ? doc.tags.some(t => t.name === tag.name) : false;
                    row += hasTag ? '1,' : '0,'; // Add '1' if the tag is applied, '0' if it's not
                });

                // Remove the trailing comma and add the row to CSV content
                csvContent += row.slice(0, -1) + "\n";
            });

            // Step 5: Encode CSV content and trigger download
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "pinned_documents_with_tags.csv");
            document.body.appendChild(link);

            link.click();
            document.body.removeChild(link);
        });

        // Implement navigation for documents (Next and Previous)
        document.getElementById('prev-doc').addEventListener('click', () => {
            if (currentDocIndex > 0) {
                loadDocument(currentDocIndex - 1);
            }
        });

        document.getElementById('next-doc').addEventListener('click', () => {
            if (currentDocIndex < fileArray.length - 1) {
                loadDocument(currentDocIndex + 1);
            }
        });

        // Implement search across all documents
document.getElementById('search').addEventListener('click', () => {
    const searchText = document.getElementById('search-text').value.toLowerCase();
    const resultsList = document.getElementById('results-list');
    resultsList.innerHTML = ''; // Clear previous search results

    let found = false;  // Track if matches are found
    let searchPromises = [];

    fileArray.forEach((file, index) => {
        if (file.type === 'pdf') {
            // Search through PDFs
            const promise = pdfjsLib.getDocument(file.url).promise.then(pdfDoc_ => {
                return pdfDoc_.getPage(1).then(page => {
                    return page.getTextContent().then(textContent => {
                        const text = textContent.items.map(item => item.str).join(' ');
                        if (text.toLowerCase().includes(searchText)) {
                            found = true;
                            const li = document.createElement('li');
                            const link = document.createElement('a');
                            link.textContent = file.name;
                            link.href = "#";
                            link.style.color = 'white';
                            link.addEventListener('click', () => loadDocument(index));
                            li.appendChild(link);
                            resultsList.appendChild(li);
                        }
                    });
                });
            });
            searchPromises.push(promise);

        } else if (file.type === 'txt') {
            // Search through .txt files
            const promise = fetch(file.url)
                .then(response => response.text())
                .then(text => {
                    if (text.toLowerCase().includes(searchText)) {
                        found = true;
                        const li = document.createElement('li');
                        const link = document.createElement('a');
                        link.textContent = file.name;
                        link.href = "#";
                        link.style.color = 'white';
                        link.addEventListener('click', () => loadDocument(index));
                        li.appendChild(link);
                        resultsList.appendChild(li);
                    }
                });
            searchPromises.push(promise);

        } else if (file.type === 'docx') {
            // Search through .docx files
            const promise = fetch(file.url)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => mammoth.extractRawText({ arrayBuffer }))
                .then(result => {
                    const text = result.value;
                    if (text.toLowerCase().includes(searchText)) {
                        found = true;
                        const li = document.createElement('li');
                        const link = document.createElement('a');
                        link.textContent = file.name;
                        link.href = "#";
                        link.style.color = 'white';
                        link.addEventListener('click', () => loadDocument(index));
                        li.appendChild(link);
                        resultsList.appendChild(li);
                    }
                });
            searchPromises.push(promise);

        } else if (file.type === 'xlsx') {
            // Search through .xlsx files using SheetJS
            const promise = fetch(file.url)
                .then(response => response.arrayBuffer())
                .then(data => {
                    const workbook = XLSX.read(data, { type: 'array' });
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const text = XLSX.utils.sheet_to_csv(worksheet);
                        if (text.toLowerCase().includes(searchText)) {
                            found = true;
                            const li = document.createElement('li');
                            const link = document.createElement('a');
                            link.textContent = file.name;
                            link.href = "#";
                            link.style.color = 'white';
                            link.addEventListener('click', () => loadDocument(index));
                            li.appendChild(link);
                            resultsList.appendChild(li);
                        }
                    });
                });
            searchPromises.push(promise);
        }
    });

    // After all searches are done, check if any match was found
    Promise.all(searchPromises).then(() => {
        if (!found) {
            const li = document.createElement('li');
            li.textContent = "No matches found";
            li.style.color = 'white';
            resultsList.appendChild(li);
        }
    });
});


        // Implement search within the current document
        document.getElementById('search-doc').addEventListener('click', () => {
            const searchText = document.getElementById('search-text').value.toLowerCase();
            const resultsList = document.getElementById('results-list');
            resultsList.innerHTML = ''; // Clear previous search results

            if (fileArray[currentDocIndex].type === 'pdf') {
                let matches = [];

                for (let i = 1; i <= pageCount; i++) {
                    pdfDoc.getPage(i).then(page => {
                        page.getTextContent().then(textContent => {
                            const text = textContent.items.map(item => item.str).join(' ');
                            if (text.toLowerCase().includes(searchText)) {
                                matches.push(i);
                                const li = document.createElement('li');
                                const link = document.createElement('a');
                                link.textContent = `Page ${i}`;
                                link.href = "#";
                                link.style.color = 'white';
                                link.addEventListener('click', () => {
                                    pageNum = i;
                                    renderPage(pageNum);
                                });
                                li.appendChild(link);
                                resultsList.appendChild(li);
                            }
                        });
                    });
                }
                
            } else if (fileArray[currentDocIndex].type === 'txt') {
                fetch(fileArray[currentDocIndex].url)
                    .then(response => response.text())
                    .then(text => {
                        const lines = text.split('\n');
                        lines.forEach((line, index) => {
                            if (line.toLowerCase().includes(searchText)) {
                                const li = document.createElement('li');
                                li.textContent = `Line ${index + 1}: ${line}`;
                                li.style.color = 'white';
                                resultsList.appendChild(li);
                            }
                        });
                        if (resultsList.innerHTML === '') {
                            resultsList.innerHTML = '<li>No matches found</li>';
                        }
                    });
            
            } else {
                resultsList.innerHTML = '<li>Search is not supported for this file type</li>';
            }
        });

        // Search on Enter key
        document.getElementById('search-text').addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                document.getElementById('search-doc').click();
            }
        });

        // Helper function to determine text color based on background color
        function getContrastColor(hexcolor) {
            // If a leading # is provided, remove it
            if (hexcolor.slice(0, 1) === '#') {
                hexcolor = hexcolor.slice(1);
            }

            // Convert to RGB value
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);

            // Get YIQ ratio
            var yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;

            // Check contrast
            return (yiq >= 128) ? 'black' : 'white';
        }
    </script>

</body>
</html>